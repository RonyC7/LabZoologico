@page "/animal-form"
@using System.Collections.Generic
@using Lab15Zoologico.Clases
@using Microsoft.AspNetCore.Components
@using System.Threading.Tasks


@code {
    private List<Animal> Animales = new List<Animal>();
    private Animal NuevoAnimal = new Animal();
    private Ave NuevaAve = new Ave();
    private Serpiente NuevaSerpiente = new Serpiente();

    private string TipoAnimalSeleccionado = "Animal";
    private Animal AnimalSeleccionadoParaEditar;
    private bool MostrarFormularioEdicion = false;
    private bool MostrarConfirmacionEliminacion = false;
    private Animal AnimalSeleccionadoParaEliminar;

    private bool MostrarMensajeExito = false;

    private async Task AgregarAnimal()
    {
        if (TipoAnimalSeleccionado == "Animal")
        {
            Animales.Add(NuevoAnimal);
            NuevoAnimal = new Animal();
        }
        else if (TipoAnimalSeleccionado == "Ave")
        {
            Animales.Add(NuevaAve);
            NuevaAve = new Ave();
        }
        else if (TipoAnimalSeleccionado == "Serpiente")
        {
            Animales.Add(NuevaSerpiente);
            NuevaSerpiente = new Serpiente();
        }
        MostrarMensajeExito = true;
        await Task.Delay(3000); 
        MostrarMensajeExito = false;
    }

    private void EditarAnimal(Animal animal)
    {
        AnimalSeleccionadoParaEditar = animal;
        MostrarFormularioEdicion = true;
        TipoAnimalSeleccionado = animal is Ave ? "Ave" : animal is Serpiente ? "Serpiente" : "Animal";
    }

    private void ConfirmarEliminarAnimal(Animal animal)
    {
        AnimalSeleccionadoParaEliminar = animal;
        MostrarConfirmacionEliminacion = true;
    }

    private void EliminarAnimal()
    {
        Animales.Remove(AnimalSeleccionadoParaEliminar);
        MostrarConfirmacionEliminacion = false;
        AnimalSeleccionadoParaEliminar = null;
    }

    private void CancelarEliminacion()
    {
        MostrarConfirmacionEliminacion = false;
        AnimalSeleccionadoParaEliminar = null;
    }
}

<h3> Ingreso de Animales</h3>

<label>Tipo de Animal:</label>
<select @bind="TipoAnimalSeleccionado">
    <option value="Animal">Animal</option>
    <option value="Ave">Ave</option>
    <option value="Serpiente">Serpiente</option>
</select>

@if (TipoAnimalSeleccionado == "Animal")
{
    <EditForm Model="NuevoAnimal">
        <DataAnnotationsValidator />
        <ValidationSummary />

        <div>
            <label>Nombre Propio:</label>
            <InputText @bind-Value="NuevoAnimal.NombrePropio" />
        </div>
        <div>
            <label>Especie:</label>
            <InputText @bind-Value="NuevoAnimal.Especie" />
        </div>
        <div>
            <label>Tipo de Alimentación:</label>
            <InputText @bind-Value="NuevoAnimal.TipoAlimentacion" />
        </div>
        <div>
            <label>Tiempo Máximo de Vida:</label>
            <InputNumber @bind-Value="NuevoAnimal.TiempoMaximoVida" />
        </div>
        <button @onclick="AgregarAnimal">Agregar Animal</button>
    </EditForm>
}
else if (TipoAnimalSeleccionado == "Ave")
{
    <EditForm Model="NuevaAve">
        <DataAnnotationsValidator />
        <ValidationSummary />

        <div>
            <label>Nombre Propio:</label>
            <InputText @bind-Value="NuevaAve.NombrePropio" />
        </div>
        <div>
            <label>Especie:</label>
            <InputText @bind-Value="NuevaAve.Especie" />
        </div>
        <div>
            <label>Tipo de Alimentación:</label>
            <InputText @bind-Value="NuevaAve.TipoAlimentacion" />
        </div>
        <div>
            <label>Tiempo Máximo de Vida:</label>
            <InputNumber @bind-Value="NuevaAve.TiempoMaximoVida" />
        </div>
        <div>
            <label>Vuela:</label>
            <InputCheckbox @bind-Value="NuevaAve.Vuela" />
        </div>
        <div>
            <label>Período de Incubación:</label>
            <InputNumber @bind-Value="NuevaAve.PeriodoIncubacion" />
        </div>
        <button @onclick="AgregarAnimal">Agregar Ave</button>
    </EditForm>
}
else if (TipoAnimalSeleccionado == "Serpiente")
{
    <EditForm Model="NuevaSerpiente">
        <DataAnnotationsValidator />
        <ValidationSummary />

        <div>
            <label>Nombre Propio:</label>
            <InputText @bind-Value="NuevaSerpiente.NombrePropio" />
        </div>
        <div>
            <label>Especie:</label>
            <InputText @bind-Value="NuevaSerpiente.Especie" />
        </div>
        <div>
            <label>Tipo de Alimentación:</label>
            <InputText @bind-Value="NuevaSerpiente.TipoAlimentacion" />
        </div>
        <div>
            <label>Tiempo Máximo de Vida:</label>
            <InputNumber @bind-Value="NuevaSerpiente.TiempoMaximoVida" />
        </div>
        <div>
            <label>Venenosa:</label>
            <InputCheckbox @bind-Value="NuevaSerpiente.Venenosa" />
        </div>
        <div>
            <label>Longitud Máxima:</label>
            <InputNumber @bind-Value="NuevaSerpiente.LongitudMaxima" />
        </div>
        <button @onclick="AgregarAnimal">Agregar Serpiente</button>
    </EditForm>
}

@if (MostrarMensajeExito)
{
    <div class="alert alert-success" role="alert">
        ¡Animal agregado exitosamente!
    </div>
}

<h3>Lista de Animales</h3>

<table class="table">
    <thead>
        <tr>
            <th>Nombre Propio</th>
            <th>Especie</th>
            <th>Tipo de Alimentación</th>
            <th>Tiempo Máximo de Vida</th>
            <th>Acciones</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var animal in Animales)
        {
            <tr>
                <td>@animal.NombrePropio</td>
                <td>@animal.Especie</td>
                <td>@animal.TipoAlimentacion</td>
                <td>@animal.TiempoMaximoVida</td>
                <td>
                    <button @onclick="() => EditarAnimal(animal)">Editar</button>
                    <button @onclick="() => ConfirmarEliminarAnimal(animal)">Eliminar</button>
                </td>
            </tr>
        }
    </tbody>
</table>

@if (MostrarConfirmacionEliminacion)
{
    <div class="modal">
        <div class="modal-content">
            <p>¿Está seguro de que desea eliminar este animal?</p>
            <button @onclick="EliminarAnimal">Sí</button>
            <button @onclick="CancelarEliminacion">No</button>
        </div>
    </div>
}
